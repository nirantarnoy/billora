<div class="p-8">
    <!-- Header -->
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
        <div>
            <h2 class="text-3xl font-bold text-slate-800">Inventory Transactions</h2>
            <p class="text-slate-500 mt-1">ประวัติความเคลื่อนไหวสินค้า (Stock Card)</p>
        </div>
        <div class="flex gap-2">
            <a href="/inventory/balances"
                class="bg-white text-slate-600 border border-slate-200 hover:bg-slate-50 px-4 py-2 rounded-xl font-semibold transition-colors flex items-center gap-2">
                <i class="fas fa-arrow-left"></i> ยอดคงเหลือ
            </a>
        </div>
    </div>

    <!-- Filters -->
    <div class="bg-white p-6 rounded-[24px] shadow-sm border border-slate-100 mb-6">
        <form method="GET" action="/inventory/transactions" class="flex flex-wrap gap-4 items-end">
            <!-- Product Filter -->
            <div class="flex-1 min-w-[200px]">
                <label class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">ค้นหาสินค้า</label>
                <input type="text" name="product" value="<%= filters.product || '' %>" placeholder="ชื่อสินค้า, SKU..."
                    class="w-full bg-slate-50 border-none rounded-xl px-4 py-2.5 text-slate-700 focus:ring-2 focus:ring-emerald-500">
            </div>

            <!-- Type Filter -->
            <div class="w-full md:w-48">
                <label class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">ประเภทรายการ</label>
                <select name="type"
                    class="w-full bg-slate-50 border-none rounded-xl px-4 py-2.5 text-slate-700 focus:ring-2 focus:ring-emerald-500">
                    <option value="">ทั้งหมด</option>
                    <% ['ISSUE','RETURN','ADJUSTMENT','RECEIVE','FULFILLMENT','TRANSFER'].forEach(t=> { %>
                        <option value="<%= t %>" <%=filters.type===t ? 'selected' : '' %>><%= t %>
                        </option>
                        <% }) %>
                </select>
            </div>

            <!-- Channel Filter -->
            <div class="w-full md:w-48">
                <label class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">ช่องทาง</label>
                <select name="channel"
                    class="w-full bg-slate-50 border-none rounded-xl px-4 py-2.5 text-slate-700 focus:ring-2 focus:ring-emerald-500">
                    <option value="">ทั้งหมด</option>
                    <option value="web" <%=filters.channel==='web' ? 'selected' : '' %>>Web / Manual</option>
                    <option value="shopee" <%=filters.channel==='shopee' ? 'selected' : '' %>>Shopee</option>
                    <option value="tiktok" <%=filters.channel==='tiktok' ? 'selected' : '' %>>TikTok</option>
                    <option value="lazada" <%=filters.channel==='lazada' ? 'selected' : '' %>>Lazada</option>
                </select>
            </div>

            <!-- Date Range -->
            <div class="w-full md:w-40">
                <label
                    class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">ตั้งแต่วันที่</label>
                <input type="date" name="startDate" value="<%= filters.startDate || '' %>"
                    class="w-full bg-slate-50 border-none rounded-xl px-4 py-2.5 text-slate-700 focus:ring-2 focus:ring-emerald-500">
            </div>
            <div class="w-full md:w-40">
                <label class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2">ถึงวันที่</label>
                <input type="date" name="endDate" value="<%= filters.endDate || '' %>"
                    class="w-full bg-slate-50 border-none rounded-xl px-4 py-2.5 text-slate-700 focus:ring-2 focus:ring-emerald-500">
            </div>

            <button type="submit"
                class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2.5 rounded-xl font-semibold transition-colors shadow-lg shadow-emerald-600/20">
                <i class="fas fa-search mr-2"></i> ค้นหา
            </button>
        </form>
    </div>

    <!-- Table -->
    <div class="bg-white rounded-[24px] shadow-sm border border-slate-100 overflow-hidden">
        <div class="overflow-x-auto">
            <table class="w-full text-left">
                <thead class="bg-slate-50 border-b border-slate-100">
                    <tr>
                        <th class="px-6 py-4 text-[10px] font-bold text-slate-400 uppercase tracking-widest">วันที่ /
                            เวลา</th>
                        <th class="px-6 py-4 text-[10px] font-bold text-slate-400 uppercase tracking-widest">ประเภท</th>
                        <th class="px-6 py-4 text-[10px] font-bold text-slate-400 uppercase tracking-widest">สินค้า</th>
                        <th class="px-6 py-4 text-[10px] font-bold text-slate-400 uppercase tracking-widest">คลัง / Lot
                        </th>
                        <th class="px-6 py-4 text-[10px] font-bold text-slate-400 uppercase tracking-widest text-right">
                            In</th>
                        <th class="px-6 py-4 text-[10px] font-bold text-slate-400 uppercase tracking-widest text-right">
                            Out</th>
                        <th class="px-6 py-4 text-[10px] font-bold text-slate-400 uppercase tracking-widest text-right">
                            มูลค่า</th>
                        <th class="px-6 py-4 text-[10px] font-bold text-slate-400 uppercase tracking-widest">ผู้ทำรายการ
                        </th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-50">
                    <% if (transactions.length===0) { %>
                        <tr>
                            <td colspan="8" class="px-6 py-12 text-center text-slate-400">
                                <i class="fas fa-history text-3xl mb-3 block opacity-50"></i>
                                ไม่พบรายการความเคลื่อนไหว
                            </td>
                        </tr>
                        <% } else { %>
                            <% transactions.forEach(t=> { %>
                                <tr class="hover:bg-slate-50 transition-colors">
                                    <td class="px-6 py-4">
                                        <div class="text-sm font-semibold text-slate-700">
                                            <%= new Date(t.transaction_date).toLocaleDateString('th-TH') %>
                                        </div>
                                        <div class="text-xs text-slate-400">
                                            <%= new Date(t.transaction_date).toLocaleTimeString('th-TH',
                                                {hour: '2-digit' , minute:'2-digit'}) %>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <% let badgeColor='bg-slate-100 text-slate-600' ; if(['ISSUE', 'RETURN_OUT'
                                            ].includes(t.type))
                                            badgeColor='bg-rose-50 text-rose-600 border border-rose-100' ;
                                            if(['RECEIVE', 'RETURN' , 'RETURN_IN' ].includes(t.type))
                                            badgeColor='bg-emerald-50 text-emerald-600 border border-emerald-100' ;
                                            if(t.type==='ADJUSTMENT' )
                                            badgeColor='bg-blue-50 text-blue-600 border border-blue-100' ; %>
                                            <span
                                                class="px-2.5 py-1 rounded-lg text-[10px] font-bold uppercase tracking-wide <%= badgeColor %>">
                                                <%= t.type %>
                                            </span>
                                            <% if(t.reference_no) { %>
                                                <div class="text-[10px] text-slate-400 mt-1 font-mono">
                                                    <%= t.reference_no %>
                                                </div>
                                                <% } %>
                                    </td>
                                    <td class="px-6 py-4">
                                        <div class="font-bold text-sm text-slate-700">
                                            <%= t.product_name %>
                                        </div>
                                        <div class="text-xs text-slate-400 font-mono">
                                            <%= t.sku %>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <div class="text-xs text-slate-600">
                                            <%= t.warehouse_name %>
                                        </div>
                                        <% if(t.lot_no) { %>
                                            <div class="text-[10px] text-slate-400 font-mono mt-0.5">Lot: <%= t.lot_no
                                                    %>
                                            </div>
                                            <% } %>
                                    </td>
                                    <td class="px-6 py-4 text-right">
                                        <% if(parseFloat(t.stock_in)> 0) { %>
                                            <span class="font-bold text-emerald-600">+<%=
                                                    parseFloat(t.stock_in).toLocaleString() %></span>
                                            <% } else { %>
                                                <span class="text-slate-300">-</span>
                                                <% } %>
                                    </td>
                                    <td class="px-6 py-4 text-right">
                                        <% if(parseFloat(t.stock_out)> 0) { %>
                                            <span class="font-bold text-rose-600">-<%=
                                                    parseFloat(t.stock_out).toLocaleString() %></span>
                                            <% } else { %>
                                                <span class="text-slate-300">-</span>
                                                <% } %>
                                    </td>
                                    <td class="px-6 py-4 text-right">
                                        <div class="text-slate-600">
                                            <%= parseFloat(t.value_amount).toLocaleString(undefined,
                                                {minimumFractionDigits: 2}) %>
                                        </div>
                                    </td>
                                    <td class="px-6 py-4">
                                        <div class="flex items-center gap-2">
                                            <div
                                                class="w-6 h-6 rounded-full bg-slate-200 flex items-center justify-center text-[10px] font-bold text-slate-500">
                                                <%= t.created_by_name ? t.created_by_name.charAt(0).toUpperCase() : '?'
                                                    %>
                                            </div>
                                            <span class="text-xs text-slate-600">
                                                <%= t.created_by_name || 'System' %>
                                            </span>
                                        </div>
                                        <% if(t.note) { %>
                                            <div class="text-[10px] text-slate-400 mt-1 italic max-w-[150px] truncate"
                                                title="<%= t.note %>">
                                                <%= t.note %>
                                            </div>
                                            <% } %>
                                    </td>
                                </tr>
                                <% }) %>
                                    <% } %>
                </tbody>
            </table>
        </div>

        <!-- Pagination (Simple) -->
        <% if (totalPages> 1) { %>
            <div class="p-4 border-t border-slate-100 flex justify-center gap-2">
                <% for(let i=1; i<=totalPages; i++) { %>
                    <a href="/inventory/transactions?page=<%= i %>&product=<%= filters.product %>&type=<%= filters.type %>&channel=<%= filters.channel %>&startDate=<%= filters.startDate %>&endDate=<%= filters.endDate %>"
                        class="w-8 h-8 flex items-center justify-center rounded-lg text-sm font-bold transition-colors <%= currentPage === i ? 'bg-emerald-600 text-white' : 'bg-slate-50 text-slate-600 hover:bg-slate-100' %>">
                        <%= i %>
                    </a>
                    <% } %>
            </div>
            <% } %>
    </div>
</div>